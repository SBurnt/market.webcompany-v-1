"3.0.7";(function(t,i,e,n){"undefined"==typeof t.easyXDM&&function(i,a,o,d,s,n){function r(e,t){var i=typeof e[t];return"function"==i||"object"==i&&e[t]||"unknown"==i}function l(){if(!u(e.plugins)&&"object"==typeof e.plugins["Shockwave Flash"]){var t=e.plugins["Shockwave Flash"].description;t&&!u(e.mimeTypes)&&e.mimeTypes["application/x-shockwave-flash"]&&e.mimeTypes["application/x-shockwave-flash"].enabledPlugin&&(S=t.match(/\d+/g))}if(!S)try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");S=Array.prototype.slice.call(i.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1)}catch(e){}return!!S&&(t=parseInt(S[0],10),i=parseInt(S[1],10),k=9<t&&0<i,!0)}function c(){if(!z){z=!0;for(var e=0;e<J.length;e++)J[e]();J.length=0}}function p(e,t){z?e.call(t):J.push(function(){e.call(t)})}function g(){var e=parent;if(""!==H)for(var t=0,i=H.split(".");t<i.length;t++)e=e[i[t]];return e.easyXDM}function h(e){var t=e.toLowerCase().match(E);e=t[2];var i=t[3];return t=t[4]||"",("http:"==e&&":80"==t||"https:"==e&&":443"==t)&&(t=""),e+"//"+i+t}function b(e){if(e=e.replace(N,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":o.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=o.protocol+"//"+o.host+t+e}for(;R.test(e);)e=e.replace(R,"");return e}function y(e,t){var i="",d=e.indexOf("#");for(var a in-1!==d&&(i=e.substring(d),e=e.substring(0,d)),d=[],t)t.hasOwnProperty(a)&&d.push(a+"="+n(t[a]));return e+(I?"#":-1==e.indexOf("?")?"?":"&")+d.join("&")+i}function u(e){return"undefined"==typeof e}function v(e,t,i){for(var n in t)if(t.hasOwnProperty(n))if(n in e){var d=t[n];"object"==typeof d?v(e[n],d,i):i||(e[n]=t[n])}else e[n]=t[n];return e}function _(e){if(u(A)){var t=a.body.appendChild(a.createElement("form")),i=t.appendChild(a.createElement("input"));i.name=F+"TEST"+C,A=i!==t.elements[i.name],a.body.removeChild(t)}if(A?t=a.createElement("<iframe name=\""+e.props.name+"\"/>"):(t=a.createElement("IFRAME"),t.name=e.props.name),t.id=t.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=a.getElementById(e.container)),e.container||(v(t.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=a.body),i=e.props.src,e.props.src="javascript:false",v(t,e.props),t.border=t.frameBorder=0,t.allowTransparency=!0,e.container.appendChild(t),e.onLoad&&B(t,"load",e.onLoad),e.usePost){var d=e.container.appendChild(a.createElement("form"));if(d.target=t.name,d.action=i,d.method="POST","object"==typeof e.usePost)for(var o in e.usePost)if(e.usePost.hasOwnProperty(o)){if(A)var s=a.createElement("<input name=\""+o+"\"/>");else s=a.createElement("INPUT"),s.name=o;s.value=e.usePost[o],d.appendChild(s)}d.submit(),d.parentNode.removeChild(d)}else t.src=i;return e.props.src=i,t}function m(t){var d=t.protocol;if(t.isHost=t.isHost||u(V.xdm_p),I=t.hash||!1,t.props||(t.props={}),t.isHost)t.remote=b(t.remote),t.channel=t.channel||"default"+C++,t.secret=Math.random().toString(16).substring(2),u(d)&&(d=h(o.href)==h(t.remote)?"4":r(i,"postMessage")||r(a,"postMessage")?"1":t.swf&&r(i,"ActiveXObject")&&l()?"6":"Gecko"===e.product&&"frameElement"in i&&-1==e.userAgent.indexOf("WebKit")?"5":t.remoteHelper?"2":"0");else{t.channel=V.xdm_c.replace(/["'<>\\]/g,""),t.secret=V.xdm_s,t.remote=V.xdm_e.replace(/["'<>\\]/g,""),d=V.xdm_p;var s;if(s=t.acl){a:{s=t.acl;var c=t.remote;"string"==typeof s&&(s=[s]);for(var w,_=s.length;_--;)if(w=s[_],w=new RegExp("^"==w.substr(0,1)?w:"^"+w.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),w.test(c)){s=!0;break a}s=!1}s=!s}if(s)throw Error("Access denied for "+t.remote)}switch(t.protocol=d,d){case"0":if(v(t,{interval:100,delay:2E3,useResize:!0,useParent:!1,usePolling:!1},!0),t.isHost){if(!t.local){d=o.protocol+"//"+o.host;var x=a.body.getElementsByTagName("img");for(c=x.length;c--;)if(s=x[c],s.src.substring(0,d.length)===d){t.local=s.src;break}t.local||(t.local=i)}d={xdm_c:t.channel,xdm_p:0},t.local===i?(t.usePolling=!0,t.useParent=!0,t.local=o.protocol+"//"+o.host+o.pathname+o.search,d.xdm_e=t.local,d.xdm_pa=1):d.xdm_e=b(t.local),t.container&&(t.useResize=!1,d.xdm_po=1),t.remote=y(t.remote,d)}else v(t,{channel:V.xdm_c,remote:V.xdm_e,useParent:!u(V.xdm_pa),usePolling:!u(V.xdm_po),useResize:!t.useParent&&t.useResize});x=[new D.stack.HashTransport(t),new D.stack.ReliableBehavior({}),new D.stack.QueueBehavior({encode:!0,maxLength:4E3-t.remote.length}),new D.stack.VerifyBehavior({initiate:t.isHost})];break;case"1":x=[new D.stack.PostMessageTransport(t)];break;case"2":t.isHost&&(t.remoteHelper=b(t.remoteHelper)),x=[new D.stack.NameTransport(t),new D.stack.QueueBehavior,new D.stack.VerifyBehavior({initiate:t.isHost})];break;case"3":x=[new D.stack.NixTransport(t)];break;case"4":x=[new D.stack.SameOriginTransport(t)];break;case"5":x=[new D.stack.FrameElementTransport(t)];break;case"6":S||l(),x=[new D.stack.FlashTransport(t)];}return x.push(new D.stack.QueueBehavior({lazy:t.lazy,remove:!0})),x}function w(e){for(var t,i={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},n=0,d=e.length;n<d;n++)t=e[n],v(t,i,!0),0!=n&&(t.down=e[n-1]),n!=d-1&&(t.up=e[n+1]);return t}function x(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var A,S,k,f=this,C=Math.floor(1E4*Math.random()),O=Function.prototype,E=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,R=/[\-\w]+\/\.\.\//,N=/([^:])\/\//g,H="",D={},t=i.easyXDM,F="easyXDM_",I=!1;if(r(i,"addEventListener"))var B=function(e,t,i){e.addEventListener(t,i,!1)},j=function(e,t,i){e.removeEventListener(t,i,!1)};else if(r(i,"attachEvent"))B=function(e,t,i){e.attachEvent("on"+t,i)},j=function(e,t,i){e.detachEvent("on"+t,i)};else throw Error("Browser not supported");var z=!1,J=[];if("readyState"in a){var G=a.readyState;z="complete"==G||~e.userAgent.indexOf("AppleWebKit/")&&("loaded"==G||"interactive"==G)}else z=!!a.body;if(!z){if(r(i,"addEventListener"))B(a,"DOMContentLoaded",c);else if(B(a,"readystatechange",function(){"complete"==a.readyState&&c()}),a.documentElement.doScroll&&i===top){var q=function(){if(!z){try{a.documentElement.doScroll("left")}catch(e){return void d(q,1)}c()}};q()}B(i,"load",c)}var V=function(e){e=e.substring(1).split("&");for(var t,i={},n=e.length;n--;)t=e[n].split("="),i[t[0]]=s(t[1]);return i}(/xdm_e=/.test(o.search)?o.search:o.hash),L=function(){var e={},t={a:[1,2,3]};return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&"{\"a\":[1,2,3]}"===JSON.stringify(t).replace(/\s/g,"")?JSON:(Object.toJSON&&"{\"a\":[1,2,3]}"===Object.toJSON(t).replace(/\s/g,"")&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t="{\"a\":[1,2,3]}".evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(L=function(){return e},e):null)};v(D,{version:"2.4.19.0",query:V,stack:{},apply:v,getJSONObject:L,whenReady:p,noConflict:function(e){return i.easyXDM=t,(H=e)&&(F="easyXDM_"+H.replace(".","_")+"_"),D}}),D.DomHelper={on:B,un:j,requiresJSON:function(e){"object"==typeof i.JSON&&i.JSON||a.write("<script type=\"text/javascript\" src=\""+e+"\"></script>")}},function(){var e={};D.Fn={set:function(t,i){e[t]=i},get:function(t,i){if(e.hasOwnProperty(t)){var n=e[t];return i&&delete e[t],n}}}}(),D.Socket=function(e){var t=w(m(e).concat([{incoming:function(t,i){e.onMessage(t,i)},callback:function(t){e.onReady&&e.onReady(t)}}])),i=h(e.remote);this.origin=h(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,i)},t.init()},D.Rpc=function(e,t){if(t.local)for(var i in t.local)if(t.local.hasOwnProperty(i)){var n=t.local[i];"function"==typeof n&&(t.local[i]={method:n})}var d=w(m(e).concat([new D.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=h(e.remote),this.destroy=function(){d.destroy()},d.init()},D.stack.SameOriginTransport=function(e){var t,i,a,s;return t={outgoing:function(e,t,i){a(e),i&&i()},destroy:function(){i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){s=h(e.remote),e.isHost?(v(e.props,{src:y(e.remote,{xdm_e:o.protocol+"//"+o.host+o.pathname,xdm_c:e.channel,xdm_p:4}),name:F+e.channel+"_provider"}),i=_(e),D.Fn.set(e.channel,function(e){return a=e,d(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,s)}})):(a=g().Fn.get(e.channel)(function(e){t.up.incoming(e,s)}),d(function(){t.up.callback(!0)},0))},init:function(){p(t.onDOMReady,t)}}},D.stack.FlashTransport=function(e){function t(e){d(function(){s.up.incoming(e,l)},0)}function i(t){var i=e.swf+"?host="+e.isHost,d="easyXDM_swf_"+Math.floor(1E4*Math.random());D.Fn.set("flash_loaded"+t.replace(/[\-.]/g,"_"),function(){D.stack.FlashTransport[t].swf=c=g.firstChild;for(var e=D.stack.FlashTransport[t].queue,i=0;i<e.length;i++)e[i]();e.length=0}),e.swfContainer?g="string"==typeof e.swfContainer?a.getElementById(e.swfContainer):e.swfContainer:(g=a.createElement("div"),v(g.style,k&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),a.body.appendChild(g));var o="callback=flash_loaded"+n(t.replace(/[\-.]/g,"_"))+"&proto="+f.location.protocol+"&domain="+n(f.location.href.match(E)[3])+"&port="+n(f.location.href.match(E)[4]||"")+"&ns="+n(H);g.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+d+"' data='"+i+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+i+"'></param><param name='flashvars' value='"+o+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+o+"' allowScriptAccess='always' wmode='transparent' src='"+i+"' height='1' width='1'></embed></object>"}var s,r,l,c,g;return s={outgoing:function(t,i,n){c.postMessage(e.channel,t.toString()),n&&n()},destroy:function(){try{c.destroyChannel(e.channel)}catch(e){}c=null,r&&(r.parentNode.removeChild(r),r=null)},onDOMReady:function(){l=e.remote,D.Fn.set("flash_"+e.channel+"_init",function(){d(function(){s.up.callback(!0)})}),D.Fn.set("flash_"+e.channel+"_onMessage",t),e.swf=b(e.swf);var n=e.swf.match(E)[3],a=function(){D.stack.FlashTransport[n].init=!0,c=D.stack.FlashTransport[n].swf,c.createChannel(e.channel,e.secret,h(e.remote),e.isHost),e.isHost&&(k&&e.swfNoThrottle&&v(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),v(e.props,{src:y(e.remote,{xdm_e:h(o.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:F+e.channel+"_provider"}),r=_(e))};D.stack.FlashTransport[n]&&D.stack.FlashTransport[n].init?a():D.stack.FlashTransport[n]?D.stack.FlashTransport[n].queue.push(a):(D.stack.FlashTransport[n]={queue:[a]},i(n))},init:function(){p(s.onDOMReady,s)}}},D.stack.PostMessageTransport=function(e){function t(t){if(t.origin)var i=h(t.origin);else if(t.uri)i=h(t.uri);else if(t.domain)i=o.protocol+"//"+t.domain;else throw"Unable to retrieve the origin of the event";i==l&&t.data&&t.data.substring&&t.data.substring(0,e.channel.length+1)==e.channel+" "&&a.up.incoming(t.data.substring(e.channel.length+1),i)}var a,s,r,l;return a={outgoing:function(t,i,n){r.postMessage(e.channel+" "+t,i||l),n&&n()},destroy:function(){j(i,"message",t),s&&(r=null,s.parentNode.removeChild(s),s=null)},onDOMReady:function(){if(l=h(e.remote),e.isHost){var n=function(o){o.data==e.channel+"-ready"&&(r="postMessage"in s.contentWindow?s.contentWindow:s.contentWindow.document,j(i,"message",n),B(i,"message",t),d(function(){a.up.callback(!0)},0))};B(i,"message",n),v(e.props,{src:y(e.remote,{xdm_e:h(o.href),xdm_c:e.channel,xdm_p:1}),name:F+e.channel+"_provider"}),s=_(e)}else B(i,"message",t),r="postMessage"in i.parent?i.parent:i.parent.document,r.postMessage(e.channel+"-ready",l),d(function(){a.up.callback(!0)},0)},init:function(){p(a.onDOMReady,a)}}},D.stack.FrameElementTransport=function(e){var t,s,r,l;return t={outgoing:function(e,t,i){r.call(this,e),i&&i()},destroy:function(){s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){l=h(e.remote),e.isHost?(v(e.props,{src:y(e.remote,{xdm_e:h(o.href),xdm_c:e.channel,xdm_p:5}),name:F+e.channel+"_provider"}),s=_(e),s.fn=function(e){return delete s.fn,r=e,d(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,l)}}):(a.referrer&&h(a.referrer)!=V.xdm_e&&(i.top.location=V.xdm_e),r=i.frameElement.fn(function(e){t.up.incoming(e,l)}),t.up.callback(!0))},init:function(){p(t.onDOMReady,t)}}},D.stack.NameTransport=function(e){function t(t){c.contentWindow.sendMessage(t,e.remoteHelper+(l?"#_3":"#_2")+e.channel)}function i(){l?2!=++f&&l||s.up.callback(!0):(t("ready"),s.up.callback(!0))}function a(e){s.up.incoming(e,x)}function o(){k&&d(function(){k(!0)},0)}var s,l,c,g,f,k,x,A;return s={outgoing:function(e,i,n){k=n,t(e)},destroy:function(){c.parentNode.removeChild(c),c=null,l&&(g.parentNode.removeChild(g),g=null)},onDOMReady:function(){l=e.isHost,f=0,x=h(e.remote),e.local=b(e.local),l?(D.Fn.set(e.channel,function(t){l&&"ready"===t&&(D.Fn.set(e.channel,a),i())}),A=y(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),v(e.props,{src:A+"#"+e.channel,name:F+e.channel+"_provider"}),g=_(e)):(e.remoteHelper=e.remote,D.Fn.set(e.channel,a));var t=function(){var n=c||this;j(n,"load",t),D.Fn.set(e.channel+"_load",o),function e(){"function"==typeof n.contentWindow.sendMessage?i():d(e,50)}()};c=_({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){p(s.onDOMReady,s)}}},D.stack.HashTransport=function(e){function t(){if(f){var e=f.location.href,t="",i=e.indexOf("#");-1!=i&&(t=e.substring(i)),t&&t!=c&&(c=t,a.up.incoming(c.substring(c.indexOf("_")+1),S))}}var a,o,s,l,c,b,f,x,A,S;return a={outgoing:function(t){if(x){var i=e.remote+"#"+b++ +"_"+t;(o||!A?x.contentWindow:x).location=i}},destroy:function(){i.clearInterval(s),!o&&A||x.parentNode.removeChild(x),x=null},onDOMReady:function(){if(o=e.isHost,l=e.interval,c="#"+e.channel,b=0,A=e.useParent,S=h(e.remote),o){if(v(e.props,{src:e.remote,name:F+e.channel+"_provider"}),A)e.onLoad=function(){f=i,s=setInterval(t,l),a.up.callback(!0)};else{var n=0,r=e.delay/50;(function i(){if(++n>r)throw Error("Unable to reference listenerwindow");try{f=x.contentWindow.frames[F+e.channel+"_consumer"]}catch(e){}f?(s=setInterval(t,l),a.up.callback(!0)):d(i,50)})()}x=_(e)}else f=i,s=setInterval(t,l),A?(x=parent,a.up.callback(!0)):(v(e,{props:{src:e.remote+"#"+e.channel+new Date,name:F+e.channel+"_consumer"},onLoad:function(){a.up.callback(!0)}}),x=_(e))},init:function(){p(a.onDOMReady,a)}}},D.stack.ReliableBehavior=function(){var e,t,i=0,d=0,a="";return e={incoming:function(n,o){var s=n.indexOf("_"),l=n.substring(0,s).split(",");n=n.substring(s+1),l[0]==i&&(a="",t&&t(!0)),0<n.length&&(e.down.outgoing(l[1]+","+i+"_"+a,o),d!=l[1]&&(d=l[1],e.up.incoming(n,o)))},outgoing:function(n,o,s){a=n,t=s,e.down.outgoing(d+","+ ++i+"_"+n,o)}}},D.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===o.length)x(i);else if(!l&&0!==o.length&&!a){l=!0;var n=o.shift();i.down.outgoing(n.data,n.origin,function(e){l=!1,n.callback&&d(function(){n.callback(e)},0),t()})}}var i,a,o=[],l=!0,h="",b=0,f=!1,v=!1;return i={init:function(){u(e)&&(e={}),e.maxLength&&(b=e.maxLength,v=!0),e.lazy?f=!0:i.down.init()},callback:function(e){l=!1;var n=i.up;t(),n.callback(e)},incoming:function(t,n){if(v){var d=t.indexOf("_"),a=parseInt(t.substring(0,d),10);h+=t.substring(d+1),0===a&&(e.encode&&(h=s(h)),i.up.incoming(h,n),h="")}else i.up.incoming(t,n)},outgoing:function(d,a,s){e.encode&&(d=n(d));var r=[];if(v){for(;0!==d.length;){var l=d.substring(0,b);d=d.substring(l.length),r.push(l)}for(;l=r.shift();)o.push({data:r.length+"_"+l,origin:a,callback:0===r.length?s:null})}else o.push({data:d,origin:a,callback:s});f?i.down.init():t()},destroy:function(){a=!0,i.down.destroy()}}},D.stack.VerifyBehavior=function(e){function t(){d=Math.random().toString(16).substring(2),i.down.outgoing(d)}var i,d,a;return i={incoming:function(o,n){var s=o.indexOf("_");-1===s?o===d?i.up.callback(!0):a||(a=o,e.initiate||t(),i.down.outgoing(o)):o.substring(0,s)===a&&i.up.incoming(o.substring(s+1),n)},outgoing:function(e,t,n){i.down.outgoing(d+"_"+e,t,n)},callback:function(){e.initiate&&t()}}},D.stack.RpcBehavior=function(e,t){function i(e){e.jsonrpc="2.0",o.down.outgoing(s.stringify(e))}function d(e,t){var n=Array.prototype.slice;return function(){var d=arguments.length,a={method:t};if(0<d&&"function"==typeof arguments[d-1]){if(1<d&&"function"==typeof arguments[d-2]){var o={success:arguments[d-2],error:arguments[d-1]};a.params=n.call(arguments,0,d-2)}else o={success:arguments[d-1]},a.params=n.call(arguments,0,d-1);l[""+ ++r]=o,a.id=r}else a.params=n.call(arguments,0);e.namedParams&&1===a.params.length&&(a.params=a.params[0]),i(a)}}function a(e,t,n,d){if(n){if(t)var a=function(e){a=O,i({id:t,result:e})},o=function(e,n){o=O;var d={id:t,error:{code:-32099,message:e}};n&&(d.error.data=n),i(d)};else a=o=O;"[object Array]"!==Object.prototype.toString.call(d)&&(d=[d]);try{var s=n.method.apply(n.scope,d.concat([a,o]));u(s)||a(s)}catch(e){o(e.message)}}else t&&i({id:t,error:{code:-32601,message:"Procedure not found."}})}var o,s=t.serializer||L(),r=0,l={};return o={incoming:function(e){var n=s.parse(e);if(n.method)t.handle?t.handle(n,i):a(n.method,n.id,t.local[n.method],n.params);else{var d=l[n.id];n.error?d.error&&d.error(n.error):d.success&&d.success(n.result),delete l[n.id]}},init:function(){if(t.remote)for(var i in t.remote)t.remote.hasOwnProperty(i)&&(e[i]=d(t.remote[i],i));o.down.init()},destroy:function(){for(var i in t.remote)t.remote.hasOwnProperty(i)&&e.hasOwnProperty(i)&&delete e[i];o.down.destroy()}}},f.easyXDM=D}(t,i,location,t.setTimeout,decodeURIComponent,encodeURIComponent),"undefined"!=typeof t.uLogin&&t.uLogin.uLoginHost||(Array.prototype.indexOf||(Array.prototype.indexOf=function(e){try{for(var t=0;t<this.length;t++)if(this[t]==e)return t}catch(e){}return-1}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),"undefined"==typeof t.console&&(t.console={log:function(){},error:function(){},info:function(){},assert:function(){}}),t.uLogin={uLoginHost:function(e){for(var t in e)if(t in e&&e[t].src&&/^https?:\/\/(.*?)\/js\/ulogin\.js/.test(e[t].src)){var i=e[t].src.match(/^https?:\/\/([^/]+)/)[1].replace(/^www\./,"");break}return"u-login.com"===i?"u-login.com":"ulogin.ru"}(i.getElementsByTagName("script"))},t.uLogin={version:"3",protocol:location.href.match(/^https/i)?"https":"http",host:encodeURIComponent(location.host),uLoginHost:uLogin.uLoginHost,supportStorage:!!("localStorage"in window&&null!==window.localStorage&&"JSON"in window&&null!==window.JSON&&"undefined"!=typeof window.JSON.parse&&"undefined"!=typeof window.JSON.stringify),supportHistory:window.history&&history.pushState,ids:[],timeouts:{},listeners:{},lang:(e.language||e.systemLanguage||e.userLanguage||"en").substr(0,2).toLowerCase(),langs:["en","ru","uk","fr","de","uz"],dialog:!1,close:!1,lightbox:!1,dialogSocket:!1,pixel:!1,providerCodes:["vkontakte","odnoklassniki","mailru","facebook","twitter","google","yandex","livejournal","openid","flickr","lastfm","linkedin","liveid","soundcloud","steam","webmoney","youtube","foursquare","tumblr","googleplus","instagram","wargaming"],providerNames:["VK","Odnoklassniki","Mail.ru","Facebook","Twitter","Google","Yandex","LiveJournal","OpenID","Flickr","Last.FM","LinkedIn","LiveID","SoundCloud","Steam","WebMoney","YouTube","foursquare","tumblr","Google+","Instagram","Wargaming.net"],states:["ready","open","receive","close","fill"],themes:["classic","flat"],widgetSettings:{},findTimer:0,waitGetWidget:{},altwayCalled:[],rc:!1,page:null,altway:function(e){return e=e.toLowerCase(),!!/iPhone|iPad/i.test(e)}(e.userAgent||e.vendor||t.opera),m:!!/(ip(ad|od|hone)|android)/i.test(e.userAgent||e.vendor||t.opera),mobile:function(e){return!(/_utl_t=vk/.test(location.href)||/_utl_t=vk/.test(document.referrer))&&(e=e.toLowerCase(),!!/(ip(ad|od|hone)|android)/i.test(e))}(e.userAgent||e.vendor||t.opera),openFromSocket:!1,ppi:null,authSocket:!1,availableParams:{id:1,redirect_uri:1,page:1,callback:1,fields:1,force_fields:1,popup_css:1,optional:1,protocol:1,host:1,lang:1,verify:1,sort:1,othprov:1,providers:1,altway:1,m:1,icons_32:1,icons_16:1},cancelClick:!1,postMessageIsAvailable:"undefined"!=typeof t.postMessage,init:function(t){if(i.body){if(this.mobile&&(this.altway=!0),this.page=encodeURIComponent(location.href),this.openFromSocket&&(this.authSocket=this.initSocket(this.buildUrl("/version/3.0/html/buttons_receiver.html",{four:"",r:parseInt(1E5*Math.random())}),this.getRC(),{background:"transparent"})),""==t&&(t=i.getElementsByTagName("script"),t=t[t.length-1].src,-1==t.indexOf("?")&&(t+="?"),t=t.substr(t.indexOf("?")+1)),""!=t){var o=this.parse(t);if(o.version&&(this.version=o.version),o.display){var s=o.id||"uLogin";if(this.get(s)){t=!0;for(var d=0;d<this.ids.length;d++)s==this.ids[d].id&&(t=!1);t&&this.setProp(o.id||"uLogin",this.ids.length,o)}else n("uLogin.init(\""+t+"\")",1E3)}}this.add(i.body,"touchmove",this.touchMove),uLogin.timeouts.search_all=n(function e(){return uLogin.findWidgets(),!("complete"===i.readyState&&(0===uLogin.findTimer&&(uLogin.findTimer=+new Date),1E4<new Date-uLogin.findTimer))&&void(uLogin.timeouts.all=n(e,50))},50),this.findWidgets(),uLogin.timeouts.search_ulogin=n(function e(){uLogin.checkAsyncWidgets(),uLogin.timeouts.search_ulogin=n(e,50)},50),this.checkAsyncWidgets(),uLogin.timeouts.check_widgets=n(function e(){uLogin.checkCurrentWidgets(),uLogin.timeouts.check_widgets=n(e,300)},30),this.checkCurrentWidgets(),this.sendPixel(),uLogin.postMessageIsAvailable&&(window.addEventListener?window.addEventListener("message",uLogin.onMessage):window.attachEvent("onmessage",uLogin.onMessage))}else n(function(){uLogin.init()},20);this.callbackReceived()},onMessage:function(e){e.origin=="https://"+uLogin.uLoginHost&&e.data&&e.data.mine&&e.data.func&&("object"==typeof e.data.func&&(e.data.func=e.data.func[0]),"to_window"===e.data.func?(src=uLogin.buildUrl(e.data.args[2],{fields:e.data.args[0],filled:e.data.args[1],set:encodeURIComponent("{window:1}")}),console.log(src),uLogin.loadWindow(src)):t[e.data.func]&&t[e.data.func].apply(uLogin,e.data.args||[]))},get:function(e){return i.getElementById(e)},exists:function(e){return"undefined"!=typeof e},add:function(t,i,n){t.addEventListener?t.addEventListener(i,function(d){"click"===i&&uLogin.cancelClick||n(t,d)},!1):t.attachEvent?t.attachEvent("on"+i,function(d){"click"===i&&uLogin.cancelClick||n(t,d)}):t["on"+i]=function(d){"click"===i&&uLogin.cancelClick||n(t,d)},"click"===i&&(this.add(t,"touchstart",this.touchStart),this.add(t,"touchend",function(t,e){return function(i,n){uLogin.cancelClick||(uLogin.cancelClick=!0,e.call(this,t,n))}}(t,n)))},touchStart:function(){uLogin.cancelClick=!1},touchMove:function(){uLogin.cancelClick=!0},is_encoded:function(e){return decodeURIComponent(e)!=e},genID:function(){for(var e=new Date,t=e.getTime()+Math.floor(1E5*Math.random());this.get("ul_"+t);)t=e.getTime()+Math.floor(1E5*Math.random());return"ul_"+t},show:function(e){this.exists(e)&&(e.style.display="block")},hide:function(e){e&&this.exists(e)&&(e.style.display="none")},parse:function(t){var i={};if(!t)return i;if("object"==typeof t)return t;var n=t.split("&");for(n=1<n.length?n:t.split(";"),t=0;t<n.length;t++){var o=n[t].split("=");o[0]&&(o[0]=o[0].trim()),o[1]&&(o[1]=o[1].trim()),i[o[0]]=o[1]}return i},scrollTop:function(){return t.pageYOffset||i.documentElement.scrollTop||i.body.scrollTop},scrollLeft:function(){return t.pageXOffset||i.documentElement.scrollLeft||i.body.scrollLeft},dialogHeight:function(){return 358},dialogWidth:function(){return 564},clientWidth:function(){var e=0;return"[object Opera]"==Object.prototype.toString.call(t.opera)&&9.5>t.parseFloat(t.opera.version())?e=i.body.clientWidth:t.innerWidth&&(e=t.innerWidth),this.isIE()&&(e=i.documentElement.clientWidth),e},clientHeight:function(){var e=0;return"[object Opera]"==Object.prototype.toString.call(t.opera)&&9.5>t.parseFloat(t.opera.version())?e=i.body.clientHeight:t.innerHeight&&(e=t.innerHeight),this.isIE()&&(e=i.documentElement.clientHeight),e},isIE:function(){if(/MSIE (\d+\.\d+);/.test(e.userAgent)){var t=+RegExp.$1;if(9>t)return t}return!1},getPPI:function(){if(null===this.ppi)try{var t=window.devicePixelRatio||1,i=document.getElementsByTagName("body")[0],n=document.createElement("div");n.style="height: 1in; left: -100%; position: absolute; top: -100%; width: 1in;",i.appendChild(n);var d=n.offsetWidth*t;i.removeChild(n),this.ppi=d}catch(e){this.ppi=96}return this.ppi},inArray:function(t,i){if(!t||!i)return!1;for(var n=0,a=i.length;n<a;n++)if(t==i[n])return n;return-1},findWidgets:function(){for(var t=0,n=[],o=[],d=i.getElementsByTagName("div"),e=i.getElementsByTagName("a");e[t];)e[t]&&(n[t]=e[t]),t++;for(t=0;d[t];)d[t]&&(o[t]=d[t]),t++;for(t=0;o[t]||n[t];)o[t]&&this.addWidget(o[t]),n[t]&&this.addWidget(n[t]),t++},addWidget:function(i,n){var a=i.id,o=i.getAttribute("data-uloginid"),e={},s=!1;"undefined"!=typeof t.uLoginParams&&(t.uLoginParams[a]?e=t.uLoginParams[a]:t.uLoginParams[o]?e=t.uLoginParams[o]:0<this.arrayIntersectKey(t.uLoginParams,this.availableParams).length&&(e=t.uLoginParams,s=!0)),n&&(e=this.extend(e,n));var r=i.getAttribute("data-ulogin")||i.getAttribute("x-ulogin-params");s=null!==r||!s&&0<this.arrayIntersectKey(e,this.availableParams).length,n=this.extend(this.parse(r),e),(o||s)&&!a&&(a=this.genID(),i.setAttribute("id",a)),o?this.getWidget(o,a):s&&this.setProp(a,this.ids.length,n)},inited:function(e){for(var t=0;t<this.ids.length;t++)if(e==this.ids[t].id)return!0;return!1},initWidget:function(e){if(e){var t=this.get(e);if(t&&(t=t.getAttribute("data-ulogin")||t.getAttribute("x-ulogin-params"))&&!this.inited(e)){t=this.parse(t);var i=this.getWidgetNumber(e);isNaN(i)?i=this.ids.length:this.ids[i]={},this.setProp(e,i,t)}}},setProp:function(t,i,n){if(this.waitGetWidget[t]||this.inited(t))return!1;this.ids[i]={id:t,dropTimer:!1,initCheck:!1,type:n.display||"",providers:n.providers||"",hidden:n.hidden||"",redirect_uri:n.redirect_uri||"",page:this.page,callback:n.callback||"",fields:n.fields||"first_name,last_name,email",force_fields:n.force_fields||"",popup_css:n.popup_css||"",optional:n.optional||"",color:n.color||"fff",opacity:n.opacity||"75",verify:n.verify||"",m:"undefined"==typeof n.m?this.m:n.m,lang:n.lang||this.lang,altway:"undefined"==typeof n.altway?this.altway:parseInt(n.altway),sort:"default"===n.sort?"default":"relevant",state:"",hidden_button:n.hidden_button||"inset",dropdown_container:n.dropdown_container||"body",icons_32:n.icons_32||"",icons_16:n.icons_16||"",theme:n.theme||"classic",client:n.client||"",event:n.event||"click"},-1==this.inArray(this.ids[i].theme,this.themes)&&(this.ids[i].theme=this.themes[0]),this.ids[i].providers||this.ids[i].other||(this.ids[i].hidden="other");if(this.ids[i].providers){var d=this.ids[i].providers.split(","),a=[];for(var o in d){var s=d[o];-1<this.inArray(s,this.providerCodes)&&a.push(s)}this.ids[i].providers=a.join(",")}if(this.ids[i].hidden&&"other"!==this.ids[i].hidden){for(o in d=this.ids[i].hidden.split(","),a=[],d)s=d[o],-1<this.inArray(s,this.providerCodes)&&a.push(s);this.ids[i].hidden=a.join(",")}switch("small"!==this.ids[i].type&&"panel"!==this.ids[i].type||this.sendStats({type:this.ids[i].type}),"window"==this.ids[i].type&&!this.ids[i].providers&&this.ids[i].hidden&&(this.ids[i].providers=this.providerCodes.join(",")),this.ids[i].mobile=0==n.mobilebuttons?0:this.mobile,this.ids[i].altway&&!this.ids[i].redirect_uri&&(this.ids[i].redirect_uri=location.href),this.ids[i].callback&&!this.ids[i].altway&&(this.ids[i].redirect_uri=""),this.ids[i].redirect_uri=this.clearRedirectUri(this.ids[i].redirect_uri),-1==this.inArray(this.ids[i].lang,this.langs)&&(this.ids[i].lang=this.lang),this.ids[i].icons_32=this.fixSiteLink(this.ids[i].icons_32),this.ids[i].icons_16=this.fixSiteLink(this.ids[i].icons_16),n.display){case"small":case"panel":this.ids[i].listener_id=!1,this.initPanel(i);break;case"window":this.initWindow(i);break;case"buttons":this.initButtons(i);break;default:this.ids.splice(i,i);}this.get(t).setAttribute("data-ulogin-inited",(+new Date).toString())},fixSiteLink:function(e){return e&&(/^https?:\/\/(.*?)/.test(e)||(/^\//.test(e)||(e="/"+e),e=location.origin+e),new RegExp("^"+location.origin).test(e)||(e="",console.error("uLogin ERROR: resource link is invalid, not match with location.origin")),e&&(e=this.is_encoded(e)?e.replace(/\//g,"%2F").replace(/\?/g,"%3F"):encodeURIComponent(e))),e},clearRedirectUri:function(e){return e?(e=e.replace(/ulogin_callback=([^&?]*?)#/,"#").replace(/ulogin_callback=(.*?)(&|$)/,"").replace(/ulogin_token=([^&?]*?)#/,"#").replace(/ulogin_token=(.*?)(&|$)/,"").replace(/(\?|&)#/,"#").replace(/(\?|&)$/,""),e=this.is_encoded(e)?e.replace(/\//g,"%2F").replace(/\?/g,"%3F"):encodeURIComponent(e)):e},initPanel:function(t){var n=this.get(this.ids[t].id),a="small"==this.ids[t].type?1:0,d=a?21:42,o=a?16:32,s=0,r=a?5:10,l=a?"16px":"32px",c="",p="";if(this.ids[t].icons_16&&a?c=decodeURIComponent(this.ids[t].icons_16):this.ids[t].icons_32&&!a?c=decodeURIComponent(this.ids[t].icons_32):(p=120<this.getPPI()?a?32:64:a?16:32,c="providers-{size}-{theme}.png?version=img.3.0.1".replace("{size}",p).replace("{theme}",this.ids[t].theme),c=this.buildUrl("version/3.0/img/"+c),p="smiles-{size}.png?version=img.3.0.1".replace("{size}",p).replace("{theme}",this.ids[t].theme),p=this.buildUrl("img/"+p),this.ids[t].hovered_sprite=p),c="url("+c+") "+(a?"0 -1px":"0 -2px")+" no-repeat",n.innerHTML="","other"===this.ids[t].hidden){var g=this.providerCodes.slice(0);if(this.ids[t].providers){p=this.ids[t].providers.split(",");for(var u,m=0;m<p.length;m++)u=this.inArray(p[m],g),-1!==u&&g.splice(u,1)}this.ids[t].hidden=g.toString()}if(this.ids[t].providers){p="relevant"===this.ids[t].sort?this.relProviders(this.ids[t].providers,this.ids[t].hidden,1):this.ids[t].providers.split(",");for(var b in s+=d*("inset"===this.ids[t].hidden_button&&0<this.ids[t].hidden.length?p.length+1:p.length),d=i.createElement("div"),this.ids[t].buttonsContainer=d,this.ids[t].buttonsContainer.className="ulogin-buttons-container",this.resetStyle(d,{width:s,maxWidth:"100%",minHeight:o,verticalAlign:"top",display:"inline-block",lineHeight:0}),n.appendChild(d),p)s=p[b],g=this.inArray(s,this.providerCodes),-1<g&&(d=i.createElement("div"),d.className="ulogin-button-"+s,d.setAttribute("data-uloginbutton",s),d.setAttribute("role","button"),d.setAttribute("title",this.providerNames[g]),this.resetStyle(d,{float:"left",width:o,height:o,margin:"0 "+r+"px "+r+"px 0",background:c,cursor:"pointer",backgroundPosition:this.getIconPosition(a,g),backgroundSize:l}),this.ids[t].buttonsContainer.appendChild(d))}this.ids[t].hidden&&(n.style.position="relative","relevant"===this.ids[t].sort&&(this.ids[t].hidden=this.relProviders(this.ids[t].providers,this.ids[t].hidden,2).join(",")),this.ids[t].drop=i.createElement("div"),this.ids[t].drop.className="ulogin-dropdown-button",this.resetStyle(this.ids[t].drop,{width:o,height:o,margin:"0 "+r+"px "+r+"px 0",cursor:"pointer",background:c,verticalAlign:"baseline",display:"inline-block",float:"none",backgroundSize:l}),this.ids[t].mobile||(this.add(this.ids[t].drop,"mouseover",function(e){uLogin.ids[t].showed=!1,uLogin.dropdownDelayed(t,a?1:2),uLogin.setOpacity(e,uLogin.ids[t].opacity)}),this.add(this.ids[t].drop,"mouseout",function(e){uLogin.ids[t].showed=!0,uLogin.dropdownDelayed(t,0),uLogin.setOpacity(e)}),this.add(this.ids[t].drop,"click",function(){uLogin.dropdown(t,a?1:2)})),"inset"===this.ids[t].hidden_button&&this.ids[t].buttonsContainer?this.ids[t].buttonsContainer.appendChild(this.ids[t].drop):n.appendChild(this.ids[t].drop),this.ids[t].mobile||this.initDrop(t)),this.ids[t].buttonsContainer&&0<this.ids[t].buttonsContainer.clientHeight&&(this.ids[t].buttonsContainer.style.height=this.ids[t].buttonsContainer.clientHeight-r+"px"),window.bc=this.ids[t].buttonsContainer,this.initButtons(t)},initWindow:function(e){var t=this.get(this.ids[e].id),n=t.getElementsByTagName("*");n.length?t=n[0]:t.innerHTML?(n=document.createElement("span"),n.innerHTML=t.innerHTML,t.innerHTML="",t=t.appendChild(n)):(n=i.createElement("img"),n.setAttribute("src",this.buildUrl("img/button.png?version=img.3.0.1")),n.setAttribute("style","cursor:pointer; width:187px; height:30px"),n.setAttribute("alt","\u041C\u0443\u043B\u044C\u0442\u0438\u0412\u0445\u043E\u0434"),t=t.appendChild(n)),t.setAttribute("data-uloginbutton","window"),t.setAttribute("data-ulogin-default","true"),this.ids[e].opacity=75,this.initButtons(e)},sendPixel:function(){if(this.getRC(),this.pixel){var e=this;n(function(){if(e.pixel){var t=i.createElement("iframe"),a=e.getRC();t.src=e.pixel.replace("[rand]",parseInt(1E5*Math.random())).replace("[u]",encodeURIComponent(location.href)).replace("[r]",encodeURIComponent(i.referrer||"")),t.width=t.height=1,t.style.display="none",a.appendChild(t),n(function(){a.removeChild(t)},3E3),e.pixel=!1}},0)}},sendStats:function(e){var t={r:parseInt(1E5*Math.random())};e.type&&(t.type=e.type),e=this.buildUrl("stats.html",t),this.initSocket(e,this.getRC())},mergeAccounts:function(e,t){if(!e)return console.error("uLogin ERROR (mergeAccounts): invalid token \""+e+"\""),!1;var i={token:e};t?("undefined"!=typeof t.join&&(t=t.join(",")),i.identities=encodeURIComponent(t),i=this.buildUrl("merge_accounts.php",i)):i=this.buildUrl("require_verify.php",i),this.loadWindow(i)},getRC:function(){var e=document.getElementById("ulogin_receiver_container");return e||(e=i.createElement("div"),e.setAttribute("id","ulogin_receiver_container"),this.resetStyle(e,{width:0,height:0,display:"none"}),i.getElementsByTagName("body")[0].appendChild(e)),e},clearTimeouts:function(){for(var e in this.timeouts)clearTimeout(this.timeouts[e])},callbackTryCall:function(e,i){this.altwayCalled.push(e),t[e]?setTimeout(function(){t[e].call(t,i)},10):setTimeout(function(){uLogin.callbackTryCall(e,i)},100)},callbackReceived:function(){var e=location.search.replace("?","");if((e=this.parse(e))&&e.ulogin_callback&&e.ulogin_token&&-1===this.inArray(e.ulogin_callback,this.altwayCalled)&&(this.callbackTryCall(e.ulogin_callback,e.ulogin_token),this.supportHistory)){var t=document.getElementsByTagName("title");t=(t=t?t[0]:"")?t.innerHTML:"",delete e.ulogin_callback,delete e.ulogin_token,e=this.buildUrl("",e,!0);var i=location.origin+location.pathname+e+location.hash;n(function(){window.history.pushState({},t,i)},1E3)}},newDialogSocket:function(e){this.dialogSocket&&this.dialogSocket.destroy(),this.dialogSocket=e},initSocket:function(i,n,a,d){d||(d=0);var o=new easyXDM.Socket({remote:i,swf:this.isIE()?this.buildUrl("js/easyxdm.swf"):"",props:{style:this.extend({margin:0,padding:0,background:"#fff",border:0,position:"absolute",left:0,top:0,overflow:"hidden",width:"100%",height:"100%"},a),frameBorder:"0"},container:n,onMessage:function(e){var i;if(/weights:/.test(e)||console.info("[uLogin] ulogin.js received message: "+e),i=e.match(/(.*?)\((.*?)\)/)){var n=i[1];e=i[2]}if(i=e.match(/^(.*?):(.*?)$/))var a=i[1],s=i[2];/^https?:\/\//.test(e)?location.href=e:/^\/auth.php\?/.test(e)?(e="https://"+uLogin.uLoginHost+e,uLogin.ids[d].altway?location.href=e:uLogin.openWithReceiver(e,d)):-1<uLogin.inArray(e,uLogin.states)?uLogin._changeState(d,e):a&&-1<uLogin.inArray(a,uLogin.states)?uLogin._changeState(d,a,"string"==typeof s?s.split(","):[]):"closeme"==e?(uLogin.hideAll(),o.destroy()):/to_window:/.test(e)?(n=uLogin.buildUrl(e.replace(/to_window:\/?/,"",""),{set:encodeURIComponent("{window:1}")}),uLogin.loadWindow(n),/to_window:\/fill\.php/.test(e)&&uLogin._changeState(d,"fill")):/weights:/.test(e)?uLogin.setWeights(e.replace(/weights:\/?/,"","")):n?"undefined"!=typeof t[n]&&(t[n].apply(t,e.split(",")),o.destroy(),uLogin.dialog&&uLogin.hideAll()):uLogin.ids[d]&&"undefined"!=typeof t[uLogin.ids[d].callback]&&(uLogin._changeState(d,"receive"),t[uLogin.ids[d].callback](e),uLogin.dialog&&uLogin.hideAll())}});return o},getWidgetNumber:function(e){for(var t=0;t<this.ids.length;t++)if(e==this.ids[t].id)return t;return NaN},onMoveWindow:function(){this.moveWindow()},loadWindow:function(n,a){null===a&&(a=!1);var o=this.ids[a]?this.ids[a].opacity:75;try{i.body.removeChild(this.lightbox)}catch(e){}try{i.body.removeChild(this.dialog)}catch(e){}var d=i.createElement("div");this.resetStyle(d,{position:"fixed",zIndex:9997,width:"100%",height:"100%",background:"#"+(this.ids[a]?this.ids[a].color:"fff"),display:"none"}),this.setOpacity(d,o),this.lightbox=d,d=i.createElement("div"),d.id=this.genID(),d.className="ulogin-popup",this.resetStyle(d,{position:"absolute",zIndex:9998,left:Math.floor(this.scrollLeft()+(this.clientWidth()-this.dialogWidth())/2),top:Math.floor(this.scrollTop()+(this.clientHeight()-this.dialogHeight())/2),width:this.dialogWidth(),height:this.dialogHeight(),overflow:"visible",display:"none",border:this.ids[a]&&"flat"===this.ids[a].theme?"5px solid #666":"10px solid #666",borderRadius:this.ids[a]&&"flat"===this.ids[a].theme?0:"8px",boxShadow:"0 2px 3px 0 rgba(0,0,0,.2),0 3px 2px -2px rgba(0,0,0,.22),0 1px 6px 0 rgba(0,0,0,.12)"}),this.dialog=d,d=i.createElement("div"),d.className="ulogin-popup-close",this.resetStyle(d,{position:"absolute",width:30,height:30,zIndex:9999,background:"url("+this.buildUrl("img/x.png")+")",cursor:"pointer",display:"none",left:"initial",top:"-15px",right:"-15px"}),this.close=d,i.body.appendChild(this.lightbox),i.body.appendChild(this.dialog),this.dialog.appendChild(this.close),this.add(this.lightbox,"click",function(){uLogin.hideAll()}),this.add(this.close,"click",function(){uLogin.hideAll()}),this.add(this.close,"mouseover",function(e){e.style.background="url("+uLogin.buildUrl("img/x_.png")+")"}),this.add(this.close,"mouseout",function(e){e.style.background="url("+uLogin.buildUrl("img/x.png")+")"}),this.add(t,"scroll",function(){uLogin.onMoveWindow()}),this.add(t,"resize",function(){uLogin.onMoveWindow()}),this.newDialogSocket(this.initSocket(n,this.dialog.getAttribute("id"),{},a)),uLogin.show(uLogin.close),uLogin.show(uLogin.lightbox),uLogin.show(uLogin.dialog),uLogin.onMoveWindow()},hideAll:function(){this.hide(this.lightbox),this.hide(this.dialog),this.hide(this.close);for(var e=0;e<this.ids.length;e++)this.ids[e].showed=!1,this.hide(this.ids[e].hiddenW),this.hide(this.ids[e].hiddenA)},moveWindow:function(){if(!this.dialog||!this.dialog.firstChild)return!1;var e=this.dialogWidth(),t=this.dialogHeight();e=(Math.floor(this.scrollLeft()+(this.clientWidth()-e)/2)-+this.dialog.style.left.slice(0,-2))/10,t=(Math.floor(this.scrollTop()+(this.clientHeight()-t)/2)-+this.dialog.style.top.slice(0,-2))/10;for(var i=0;10>i;i++)this.dialog.style.left=e+ +this.dialog.style.left.slice(0,-2)+"px",this.dialog.style.top=t+ +this.dialog.style.top.slice(0,-2)+"px"},resetStyle:function(t,i){i||(i={});var n,a=this.extend({margin:0,padding:0,outline:"none",border:"none",borderRadius:0,cursor:"default",float:"none",position:"relative",display:"inherit",width:"auto",height:"auto",left:0,top:0,boxSizing:"content-box"},i),d=["width","height","left","top"],e=["float"];for(n in a){-1<this.inArray(n,d)&&"number"==typeof a[n]&&(a[n]+="px");try{-1<this.inArray(n,e)&&t.style.setProperty(n,a[n])}catch(e){}try{t.style[n]=a[n]}catch(e){}}},getIconPosition:function(e,t){return e?"0 -"+(18+17*t)+"px":"0 -"+(36+34*t)+"px"},setOpacity:function(e,t){e.style.filter=t?"alpha(opacity="+t+") progid:DXImageTransform.Microsoft.AlphaImageLoader(src=transparent.png, sizingMethod='crop')":"",e.style.opacity=t?parseFloat(t)/100:""},initDrop:function(t){if(!this.ids[t].mobile&&""!=this.ids[t].hidden){var n=this.get(this.ids[t].id),a=this.genID(),d=310<23*this.ids[t].hidden.split(",").length-2?310:23*this.ids[t].hidden.split(",").length-2,o=i.createElement("div");o.className="ulogin-dropdown",o.id=a,this.resetStyle(o,{position:"absolute",zIndex:9999,width:128,height:d,border:"flat"===this.ids[t].theme?"3px solid #666":"5px solid #666",borderRadius:"flat"===this.ids[t].theme?0:"4px",boxShadow:"0 2px 2px 0 rgba(0,0,0,.14),0 3px 1px -2px rgba(0,0,0,.2),0 1px 5px 0 rgba(0,0,0,.12)",display:"none"}),this.ids[t].hiddenW=o,"body"===this.ids[t].dropdown_container?i.body.appendChild(this.ids[t].hiddenW):n.appendChild(this.ids[t].hiddenW),o=this.buildUrl("/version/3.0/html/drop.html",{id:t,redirect_uri:this.ids[t].redirect_uri,callback:this.ids[t].callback,providers:this.ids[t].hidden,fields:this.ids[t].fields,force_fields:this.ids[t].force_fields,popup_css:this.ids[t].popup_css,optional:this.ids[t].optional,othprov:this.ids[t].providers,protocol:this.protocol,host:this.host,lang:this.ids[t].lang,verify:this.ids[t].verify,sort:this.ids[t].sort,altway:this.ids[t].altway?1:null,m:this.ids[t].m?1:0,icons_32:this.ids[t].icons_32,icons_16:this.ids[t].icons_16,theme:this.ids[t].theme,client:this.ids[t].client,page:this.page,version:this.version}),this.initSocket(o,a,{position:"relative",width:"128px",height:d+"px"},t),o=i.createElement("div"),this.resetStyle(o,{position:"absolute",background:"#000",left:"initial",right:"flat"===this.ids[t].theme?"-3px":"-5px",top:"100%",width:41,height:13,border:"flat"===this.ids[t].theme?"3px solid #666":"5px solid #666",textAlign:"center"}),d=i.createElement("a"),d.href=this.buildUrl(""),d.target="_blank",this.resetStyle(d,{width:41,height:13,background:"url("+this.buildUrl("img/text.png")+") no-repeat"}),o.appendChild(d),this.ids[t].hiddenW.appendChild(o),o=i.createElement("div"),this.resetStyle(o,{width:0,height:0,position:"absolute",zIndex:9999,display:"none",border:"5px solid transparent",borderBottomColor:"#666"}),this.ids[t].hiddenA=o,n.appendChild(this.ids[t].hiddenA),this.ids[t].showed=!1,this.add(i.body,"click",function(e,t){t.target||(t.target=t.srcElement);for(var i=0;i<uLogin.ids.length;i++)t.target!=uLogin.ids[i].drop&&(uLogin.hide(uLogin.ids[i].hiddenW),uLogin.hide(uLogin.ids[i].hiddenA))}),this.ids[t].hiddenW&&this.ids[t].hiddenA&&(this.add(this.ids[t].hiddenW,"mouseout",function(){uLogin.dropdownDelayed(t,0)}),this.add(this.ids[t].hiddenA,"mouseout",function(){uLogin.dropdownDelayed(t,0)}),this.add(this.ids[t].hiddenW,"mouseover",function(){uLogin.clearDropTimer(t)}),this.add(this.ids[t].hiddenA,"mouseover",function(){uLogin.clearDropTimer(t)}))}},showDrop:function(t,i){if(this.ids[t].hiddenW||this.ids[t].hiddenA)if(this.ids[t].showed||0==i)this.hide(this.ids[t].hiddenW),this.hide(this.ids[t].hiddenA),this.ids[t].showed=!1;else{this.show(this.ids[t].hiddenA),this.show(this.ids[t].hiddenW),this.ids[t].showed=!0;var n=this.ids[t].drop;if("body"===this.ids[t].dropdown_container){var d=this.getOffset(n),a=d.left;d=d.top,this.ids[t].hiddenW.style.left=a-(1==i?100:106)+"px",this.ids[t].hiddenW.style.top=d+(1==i?21:37)+"px",this.ids[t].hiddenA.style.left=a+(1==i?4:12)+"px",this.ids[t].hiddenA.style.top=d+(1==i?17:33)+"px"}a=n.offsetLeft,d=n.offsetTop,a-=n.scrollLeft,d-=n.scrollTop,"body"!==this.ids[t].dropdown_container&&(this.ids[t].hiddenW.style.left=a-(1==i?100:106)+"px",this.ids[t].hiddenW.style.top=d+(1==i?21:37)+"px"),this.ids[t].hiddenA.style.left=a+(1==i?4:12)+"px",this.ids[t].hiddenA.style.top=d+(1==i?12:28)+"px"}},clearDropTimer:function(e){this.ids[e].dropTimer&&t.clearTimeout(this.ids[e].dropTimer)},dropdown:function(e,t){this.ids[e].mobile||(this.clearDropTimer(e),this.showDrop(e,t))},dropdownDelayed:function(e,t){this.clearDropTimer(e),this.ids[e].dropTimer=n(function(){uLogin.showDrop(e,t)},600)},initButtons:function(i){var e=this.get(this.ids[i].id);this.ids[i].mobile&&this.add(this.get(this.ids[i].id),"click",function(n,d){d.preventDefault?d.preventDefault():d.returnValue=!1;var e=uLogin.buildUrl("version/3.0/html/mobile.html",{id:uLogin.ids[i].id,redirect_uri:uLogin.ids[i].redirect_uri,callback:uLogin.ids[i].callback,fields:uLogin.ids[i].fields,force_fields:uLogin.ids[i].force_fields,popup_css:uLogin.ids[i].popup_css,optional:uLogin.ids[i].optional,protocol:uLogin.ids[i].protocol,host:uLogin.host,lang:uLogin.ids[i].lang,verify:uLogin.ids[i].verify,providers:uLogin.ids[i].providers,hidden:uLogin.ids[i].hidden,icons_32:uLogin.ids[i].icons_32,altway:uLogin.ids[i].altway?1:null,page:uLogin.page,m:uLogin.ids[i].m?1:0,icons_16:uLogin.ids[i].icons_16,theme:uLogin.ids[i].theme,client:uLogin.ids[i].client,version:uLogin.version});return uLogin.ids[i].altway?t.top?t.top.location.href=e:location.href=e:uLogin.openWithReceiver(e,i),!1}),"window"===this.ids[i].type?this._proceedChildren(e,this._(this._initButton),i):(this.ids[i].providers="",this._proceedChildren(e,this._(this._initButton),i),this.ids[i].providers=this.ids[i].providers.slice(0,this.ids[i].providers.length-1)),this._changeState(i,this.states[0])},_:function(e){return function(){e.apply(uLogin,arguments)}},_proceedChildren:function(t,i,n){t=t.childNodes;var d,o;for(o=0;o<t.length;o++){var s=t[o];s.getAttribute&&(i(s,n),(d=s.getAttribute("data-uloginbutton")||s.getAttribute("x-ulogin-button"))&&-1<this.inArray(d,this.providerCodes)&&!new RegExp(d+"(,|$)","i").test(this.ids[n].providers)&&(this.ids[n].providers+=d+",")),this._proceedChildren(s,i,n)}},_initButton:function(t,i){var n=t.getAttribute("data-uloginbutton")||t.getAttribute("x-ulogin-button");if(n)if(-1<this.inArray(n,this.providerCodes))this.add(t,"mouseover",function(e){if(/disabled/.test(e.className))return!1;if(uLogin.setOpacity(e,parseFloat(uLogin.ids[i].opacity)),+new Date<+new Date("2017/04/02 03:00:00")&&uLogin.ids[i].hovered_sprite&&!e.getAttribute("data-original-background")){var t=e.offsetHeight*uLogin.randFromTo(0,24),n="ru"===uLogin.ids[i].lang?"1 \u0430\u043F\u0440\u0435\u043B\u044F - \u0434\u0435\u043D\u044C \u0441\u043C\u0435\u0445\u0430! \u0423\u043B\u044B\u0431\u0430\u0439\u0442\u0435\u0441\u044C )":"April Fools' Day is here!";e.setAttribute("data-original-background",e.style.background),e.style.background="url("+uLogin.ids[i].hovered_sprite+") 0px -"+t+"px no-repeat",e.setAttribute("data-original-title",e.getAttribute("title")),e.setAttribute("title",n)}}),this.add(t,"mouseout",function(e){return!/disabled/.test(e.className)&&void(uLogin.setOpacity(e),e.getAttribute("data-original-background")&&(e.style.background=e.getAttribute("data-original-background"),e.removeAttribute("data-original-background")),e.getAttribute("data-original-title")&&(e.setAttribute("title",e.getAttribute("data-original-title")),e.removeAttribute("data-original-title")))}),this.ids[i].mobile||this.add(t,"click",function(e){if(/disabled/.test(e.className))return!1;var t=e.getAttribute("data-uloginbutton")||e.getAttribute("x-ulogin-button");return!e.getAttribute("data-disabled-click")&&void(e.setAttribute("data-disabled-click","1"),setTimeout(function(){e.setAttribute("data-disabled-click","")},1E3),uLogin.startAuth(t,"",i))});else if("window"===n&&(this.ids[i].mobile||this.add(t,this.ids[i].event,function(e,t){if(t.preventDefault?t.preventDefault():t.returnValue=!1,/disabled/.test(e.className))return!1;var n=uLogin.buildUrl(uLogin.ids[i].mobile?"version/3.0/html/mobile.html":"version/3.0/html/window.html",{id:i,redirect_uri:uLogin.ids[i].redirect_uri,callback:uLogin.ids[i].callback,fields:uLogin.ids[i].fields,force_fields:uLogin.ids[i].force_fields,popup_css:uLogin.ids[i].popup_css,optional:uLogin.ids[i].optional,protocol:uLogin.protocol,host:uLogin.host,lang:uLogin.ids[i].lang,verify:uLogin.ids[i].verify,sort:uLogin.ids[i].sort,othprov:uLogin.ids[i].hidden,providers:uLogin.ids[i].providers,altway:uLogin.ids[i].altway?1:null,m:uLogin.ids[i].m?1:0,icons_32:uLogin.ids[i].icons_32,icons_16:uLogin.ids[i].icons_16,theme:uLogin.ids[i].theme,client:uLogin.ids[i].client,page:uLogin.page,version:uLogin.version});return uLogin.loadWindow(n,i),!1}),t.getAttribute("data-ulogin-default"))){var d=this.buildUrl("img/"+("ru"==this.ids[i].lang?"":this.ids[i].lang+"/")+"button.png?version=img.3.0.1"),e=this.buildUrl("img/"+("ru"==this.ids[i].lang?"":this.ids[i].lang+"/")+"button_.png");t.src=d,this.resetStyle(t,{cursor:"pointer"}),this.add(t,"mouseover",function(t){return!/disabled/.test(t.parentNode.className)&&void(t.src!=e&&(t.src=e))}),this.add(t,"mouseout",function(e){return!/disabled/.test(e.parentNode.className)&&void(e.src!=d&&(e.src=d))})}},randFromTo:function(e,t){return Math.floor(Math.random()*t)+e},sendWeight:function(e){this.initSocket(this.buildUrl("version/3.0/html/weight_set.html",{provider:e,r:parseInt(1E5*Math.random())}),this.getRC(),{background:"transparent"})},setWeights:function(e){this.supportStorage&&(localStorage.providers_weight=e)},getWeights:function(){try{return JSON.parse(localStorage.providers_weight)}catch(e){return{}}},relProviders:function(t,i,n){if(t=t.split(","),i=i.split(","),this.supportStorage){var d,o=this.getWeights();for(d in o){o=this.inArray(d,t);var s=this.inArray(d,i);-1===o?-1!==s&&(t.splice(0,0,d),i.splice(s,1),i.splice(0,0,t[t.length-1]),t.splice(t.length-1,1)):(t.splice(o,1),t.splice(0,0,d))}}return 1===n?t:i},startAuth:function(i,n,o){var d={name:i,window:1,lang:this.ids[o].lang,fields:this.ids[o].fields,force_fields:this.ids[o].force_fields,popup_css:this.ids[o].popup_css,host:this.host,optional:this.ids[o].optional,redirect_uri:this.ids[o].redirect_uri||location.href,verify:this.ids[o].verify,callback:this.ids[o].callback,screen:screen.width+"x"+screen.height,url:n,providers:this.ids[o].providers,hidden:this.ids[o].hidden,m:this.ids[o].m?1:0,page:this.page,icons_32:this.ids[o].icons_32,icons_16:this.ids[o].icons_16,theme:this.ids[o].theme,client:this.ids[o].client,version:this.version};this.ids[o].altway&&(d.altway=1),i=n||"webmoney"!=i&&"livejournal"!=i&&"openid"!=i?this.buildUrl("auth.php",d):this.buildUrl("url.php",d),this._changeState(o,this.states[1]),this.ids[o].altway?t.top?t.top.location.href=i:location.href=i:this.openWithReceiver(i,o)},openWithReceiver:function(t,i){i||(i=0);var n=660,a=420;/name=vkontakte/.test(t)?a=380:/name=facebook/.test(t)?(n=560,a=350):/name=google/.test(t)?(n=800,a=630):/name=yandex/.test(t)?(n=990,a=530):/name=lastfm/.test(t)&&(n=1368,a=894),this.openFromSocket?this.authSocket.postMessage("window.open::"+t+"::"+n+"::"+a+"::"+(screen.width-n)/2+"::"+(screen.height-a)/2):(this.initSocket(this.buildUrl("/version/3.0/html/buttons_receiver.html",{four:encodeURIComponent(t),r:parseInt(1E5*Math.random())}),this.getRC(),{background:"transparent"},i),uLogin.getRC().getElementsByTagName("iframe"),window.open(t,"uLogin_window","width="+n+",height="+a+",left="+(screen.width-n)/2+",top="+(screen.height-a)/2))},checkWindow:function(){},checkCurrentWidgets:function(){for(var e=0;this.ids[e];)this.checkWidget(this.ids[e++].id)},checkWidget:function(t,i){var n=this.get(t);if(!n)this.ids[this.getWidgetNumber(t)].id=!1;else if(this.inited(t)){var a=this.getWidgetNumber(t),e=this.ids[a].type;if(("small"===e||"panel"===e)&&!n.childNodes.length)return n=this.ids[a].id,uLogin.ids[a].id=!1,uLogin.initWidget(n),!0;n.getAttribute("data-ulogin-inited")||(n=this.ids[a].id,uLogin.ids[a].id=!1,uLogin.initWidget(n))}else this.addWidget(this.get(t),i)},buildUrl:function(t,i,n){i||(i={}),n||(n=!1),t=t?"https://"+this.uLoginHost+"/"+t:"";var o,s="";for(o in i){var r=i[o];null!==r&&(!n&&(/\?/.test(r)||/\//.test(r)||/:/.test(r))&&(r=""),s+=o+"="+r+"&")}return 0<s.length&&(s=s.substring(0,s.length-1),t=t+(/\?/.test(t)?"&":"?")+s),t},getWidget:function(t,n){if(this.inited(n))return!1;if(this.widgetSettings[t])return this.setProp(n,uLogin.ids.length,this.widgetSettings[t]),!1;if(this.waitGetWidget[t]&&-1!==this.inArray(n,this.waitGetWidget[t]))return!1;if(this.waitGetWidget[t]||(this.waitGetWidget[t]=[]),this.waitGetWidget[t].push(n),this.widgetSettings[t])this.setProp(n,this.ids.length,this.widgetSettings[t]);else{var a=this.getRC(),d=i.createElement("script");d.async=!0,d.src=this.buildUrl("getwidget",{widgetid:t}),a.appendChild(d)}},forElements:function(e,t){if(e&&e.length)for(var i in e)t(e[i])},setWidget:function(e,t,n){return!n&&t&&(n=t),"not_found"===e?(this.forElements(this.waitGetWidget[e],function(t){return"string"==typeof t&&void i.getElementById(t).setAttribute("data-uloginid","")}),!1):void(n&&!uLogin.widgetSettings[e]&&"undefined"!=typeof n.display&&(this.forElements(this.waitGetWidget[e],function(t){if("string"!=typeof t)return!1;var e=i.getElementById(t);if(!e)return console.error("uLogin ERROR: not found element with id \""+t+"\""),!1;for(var d in e=uLogin.parse(e.getAttribute("data-ulogin")),e)n[d]=e[d];uLogin.setProp(t,uLogin.ids.length,n)}),this.widgetSettings[e]=n))},customInit:function(){for(var e=0;e<arguments.length;e++)if("string"==typeof arguments[e]){var t=!1;if(!uLogin.get(arguments[e])||!arguments[e])return console.error("uLogin ERROR (customInit): Element with ID=\""+arguments[e]+"\" not found"),!1;1<arguments.length&&"object"==typeof arguments[arguments.length-1]&&(t=arguments[arguments.length-1]),uLogin.checkWidget(arguments[e],t)}},getOffsetSum:function(e){for(var t=0,i=0;e;)t+=parseFloat(e.offsetTop),i+=parseFloat(e.offsetLeft),e=e.offsetParent;return{top:Math.round(t),left:Math.round(i)}},getOffsetRect:function(e){e=e.getBoundingClientRect();var t=document.body,i=document.documentElement;return{top:Math.round(e.top+(window.pageYOffset||i.scrollTop||t.scrollTop)-(i.clientTop||t.clientTop||0)),left:Math.round(e.left+(window.pageXOffset||i.scrollLeft||t.scrollLeft)-(i.clientLeft||t.clientLeft||0))}},getOffset:function(e){return e.getBoundingClientRect?this.getOffsetRect(e):this.getOffsetSum(e)},checkAsyncWidgets:function(){var e=this.get("ulogin")||this.get("uLogin");e&&e.id&&this.addWidget(e)},setStateListener:function(e,t,i){return this.listeners[e]||(this.listeners[e]={}),this.listeners[e][t]||(this.listeners[e][t]=[]),this.listeners[e][t].push(i)-1},removeStateListener:function(e,t,i){return!!(this.listeners[e]&&this.listeners[e][i])&&this.listeners[e][i].splice(t,1)},_changeState:function(i,n,a){try{this.ids[i].state=n;for(var d=0;this.listeners[this.ids[i].id][n][d];)this.listeners[this.ids[i].id][n][d++].apply(t,"object"==typeof a?a:[])}catch(e){}},extend:function(e,t){for(var i in t)e[i]=t[i];return e},arrayIntersectKey:function(t,i){var n,a=[];for(n in t)n in i&&a.push(n);return a}},-1==uLogin.inArray(uLogin.lang,uLogin.langs)&&(uLogin.lang=uLogin.langs[0]),uLogin.init("undefined"==typeof uLogin_query?"":uLogin_query)),t.receiver=function(e,i,n){uLogin._changeState(0,"receive",[e]),!n&&i&&(n=i),t[n](e)},t.redirect=function(t,n){var a=i.createElement("form");a.action=n,a.method="post",a.target="_top",a.style.display="none";var d=i.createElement("input");d.type="hidden",d.name="token",d.value=t,a.appendChild(d),i.body.appendChild(a),a.submit()}})(window,document,navigator,setTimeout);